<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Square SDK Test</title>
  <script src="https://web.squarecdn.com/v1/square.js"></script>
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 400px; margin: 0 auto; }
    #card-container { min-height: 60px; border: 1px solid #ccc; border-radius: 8px; padding: 12px; margin: 16px 0; }
    #status { padding: 12px; border-radius: 8px; font-size: 13px; word-break: break-all; white-space: pre-wrap; }
    .loading { background: #f0f0ff; color: #333; }
    .success { background: #e0ffe0; color: #060; }
    .error { background: #ffe0e0; color: #900; }
  </style>
</head>
<body>
  <h2>Square SDK Test</h2>
  <p style="font-size:12px;color:#666;">React/Next.js なし。SDK単体テスト。</p>
  <div id="card-container"></div>
  <div id="status" class="loading">SDK読み込み中...</div>

  <script>
    var statusEl = document.getElementById('status');
    function setStatus(msg, type) {
      statusEl.textContent = msg;
      statusEl.className = type || 'loading';
    }

    (async function() {
      try {
        if (!window.Square) {
          setStatus('ERROR: window.Square が存在しません。SDKの読み込みに失敗。', 'error');
          return;
        }

        setStatus('Step 1: payments("sq0idp-LscgJ-AE5LHX_Asn2yvyYQ", "L1D5CFHAVYWBE") 呼び出し中...');
        var payments = await window.Square.payments('sq0idp-LscgJ-AE5LHX_Asn2yvyYQ', 'L1D5CFHAVYWBE');
        setStatus('Step 1 成功。\nStep 2: card() 呼び出し中...');

        var card = await payments.card();
        setStatus('Step 2 成功。\nStep 3: attach() 呼び出し中...');

        await card.attach(document.getElementById('card-container'));
        setStatus('全ステップ成功！カード入力フォームが表示されているはずです。', 'success');
      } catch (e) {
        var detail = JSON.stringify({
          message: e.message || '不明',
          type: (e.constructor && e.constructor.name) || 'Error',
          keys: Object.keys(e || {}),
          stack: (e.stack || '').substring(0, 500)
        }, null, 2);
        setStatus('ERROR at current step:\n' + detail, 'error');
      }
    })();
  </script>
</body>
</html>
